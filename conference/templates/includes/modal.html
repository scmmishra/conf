{% block head_includes %}
<style>
	.animated {
		-webkit-animation-duration: 1s;
		animation-duration: 1s;
		-webkit-animation-fill-mode: both;
		animation-fill-mode: both;
	}

	.animated.faster {
		-webkit-animation-duration: 500ms;
		animation-duration: 500ms;
	}

	.fadeIn {
		-webkit-animation-name: fadeIn;
		animation-name: fadeIn;
	}

	.fadeOut {
		-webkit-animation-name: fadeOut;
		animation-name: fadeOut;
	}

	@keyframes fadeIn {
		from {
			  bottom: -100%;
		}

		to {
			  bottom: 0%;
		}
	}

	@keyframes fadeOut {
		from {
			opacity: 1;
		}

		to {
			opacity: 0;
		}
	}
</style>
{% endblock %}

<div class="main-modal fixed w-full h-100 inset-0 z-50 overflow-hidden flex justify-center items-end lg:items-center animated fadeIn faster" style="background: rgba(0,0,0,.7);">
	<div class="shadow-lg modal-container bg-white w-full md:max-w-md mx-auto rounded-t-lg lg:rounded-b-lg shadow-lg z-50 overflow-y-auto">
		<div class="modal-content py-4 text-left px-6">
			<!--Title-->
			<div class="flex justify-between items-center pb-3">
				<p class="text-2xl font-bold">Register</p>
				<div class="modal-close cursor-pointer z-50">
					<svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
						viewBox="0 0 18 18">
						<path
							d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z">
						</path>
					</svg>
				</div>
			</div>
			<!--Body-->
			<form id="register-form" class="my-5">
				<div class="mb-4">
					<label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="grid-first-name">Name</label>
					<input class="appearance-none block w-full bg-gray-200 text-gray-700 border rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white" id="name" type="text" placeholder="Jane Doe" required="True">
					<p id="error-name" class="text-xs text-red-500 mt-2 hidden">This field is required</p>
				</div>
				<div class="mb-4">
					<label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="grid-first-name">E-mail</label>
					<input class="appearance-none block w-full bg-gray-200 text-gray-700 border rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white" id="email" type="email" placeholder="jane@example.com" required="True">
					<p id="error-email" class="text-xs text-red-500 mt-2 hidden">Please enter a valid email</p>
				</div>
				<div class="mb-6">
					<label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="grid-first-name">Organization You Represent</label>
					<input class="appearance-none block w-full bg-gray-200 text-gray-700 border rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white" id="organization" type="text" placeholder="Cool Stuff Inc.">
					<p id="error-organization" class="text-xs text-red-500 mt-2 hidden">This field is required</p>
				</div>
			</form>
			<!--Footer-->
			<div class="flex justify-end pt-5">
				<button href="#responsive-header" class="font-mono font-base font-mono no-underline text-grey-darkest mr-3 bg-gray-400 px-3 py-2 rounded border-gray-500 border-b-4 hover:border-gray-600 modal-close">
					Cancel
				</button>
				<button href="#responsive-header" class="font-mono font-base font-mono no-underline text-grey-darkest bg-yellow-400 px-3 py-2 rounded border-yellow-500 border-b-4 hover:border-yellow-600" onclick="register()">
					Register Free
				</button>
			</div>
		</div>
	</div>
</div>

{% block script %}
<script>
	const modal = document.querySelector('.main-modal');
	const closeButton = document.querySelectorAll('.modal-close');

	const modalClose = () => {
		modal.classList.remove('fadeIn');
		modal.classList.add('fadeOut');
		setTimeout(() => {
			modal.style.display = 'none';
		}, 500);
	}

	const openModal = () => {
		modal.classList.remove('fadeOut');
		modal.classList.add('fadeIn');
		modal.style.display = 'flex';
	}

	for (let i = 0; i < closeButton.length; i++) {
		const elements = closeButton[i];
		elements.onclick = (e) => modalClose();
		modal.style.display = 'none';
		window.onclick = function (event) {
			if (event.target == modal) modalClose();
		}
	}

	fetch_form = function(formData, required) {
		var form = {};
		formData.forEach(function(value, key){
    		form[key] = value;
		});

		if (Object.keys(form) == required) return form
		return false
	}

	function register() {
		let validated = true
		let inputs = ['name', 'email', 'organization'];
		inputs.forEach((id) => {
			let element = document.getElementById(id)
			if(!element.checkValidity()) {
				validated = false
				document.getElementById(`error-${id}`).classList.remove("hidden")
			}
			else {
				document.getElementById(`error-${id}`).classList.add("hidden")
			}
		});

		if (validated) {
			let form = {}
			inputs.forEach((id) => form[id] = document.getElementById(id).value)
			form.event = "IndiaOS 2019"
			frappe.call('conference.conference.doctype.conference_participant.conference_participant.register', form).then(res => {
				document.forms.namedItem('register-form').reset()
			})
		}
		else return
	}
</script>
{% endblock %}